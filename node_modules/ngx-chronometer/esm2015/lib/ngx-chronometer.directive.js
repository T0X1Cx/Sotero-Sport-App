import { Directive, Input, Output, EventEmitter } from '@angular/core';
import { Chronometer, StatusChonometer } from './ngx-chronometer';
import { interval, Subject } from 'rxjs';
import * as _ from 'lodash';
export class NgxChronometerDirective {
    constructor() {
        // tslint:disable-next-line:variable-name
        this._chronometer = new Chronometer();
        /** sequence the time default 1000 = 1 second */
        this.interval = 1000;
        /** increment 1 unit */
        this.increment = 1;
        /** format to use default 00:00:00 custom 00/00/00 or other delimiter */
        this.format = '00:00:00';
        /** activated emit event sequence chronometer default false */
        this.chronoEvents = false;
        // tslint:disable-next-line:no-output-on-prefix
        this.onChronoEvent = new EventEmitter();
    }
    /** object chronometer */
    set chronometer(chronometer) {
        chronometer = chronometer || new Chronometer();
        chronometer.maxSecond = this.maxSecond || chronometer.maxSecond || 60;
        chronometer.maxMinute = this.maxMinute || chronometer.maxMinute || 60;
        chronometer.maxHour = this.maxHour || chronometer.maxHour || 60;
        chronometer.time = new Array(0, 0, 0);
        this._chronometer = this.activated(this.currentSecond(chronometer));
    }
    ngOnInit() {
        // tslint:disable-next-line:max-line-length
        if (this._chronometer.onChronometer.observers == null) {
            this._chronometer.onChronometer = new Subject();
        }
        this.chronoSub = this._chronometer.onChronometer.subscribe((chronometer) => {
            this._chronometer = this.activated(this.currentSecond(chronometer));
        });
    }
    /**
     * @description current seconds
     * @param chronometer object current chronometer
     * @see {Chronometer}
     */
    currentSecond(chronometer) {
        const limitSecond = this.limitSecond || chronometer.limitSecond;
        if (limitSecond && chronometer.second > limitSecond) {
            chronometer.second = limitSecond;
            chronometer.pause();
            this._chronometer = chronometer;
            if (this._chronometer.intervalSub) {
                this._chronometer.intervalSub.unsubscribe();
            }
            this._chronometer.intervalSub = undefined;
        }
        return chronometer;
    }
    /**
     * @description activated chronometer
     * @param chronometer object current chronometer
     * @see {Chronometer}
     */
    activated(chronometer = this._chronometer) {
        switch (chronometer.status) {
            case StatusChonometer.pause:
                this._chronometer = this.pause(chronometer);
                break;
            case StatusChonometer.start:
                this._chronometer = this.start(this.pause(chronometer));
                break;
            case StatusChonometer.restart:
                chronometer.second = 0;
                this._chronometer = this.start(chronometer);
                break;
            case StatusChonometer.stop:
                chronometer.second = 0;
                this._chronometer = this.pause(chronometer);
                break;
            default:
                break;
        }
        return this.setTime(chronometer, 0);
    }
    /**
     * @description pause seconds
     * @param chronometer object current chronometer
     * @see {Chronometer}
     */
    pause(chronometer) {
        return this.stop(chronometer);
    }
    /**
     * @description stop seconds
     * @param chronometer object current chronometer
     * @see {Chronometer}
     */
    stop(chronometer) {
        if (chronometer.intervalSub) {
            chronometer.intervalSub.unsubscribe();
            chronometer.intervalSub = undefined;
        }
        return chronometer;
    }
    /**
     * @description start seconds
     * @param chronometer object current chronometer
     * @see {Chronometer}
     */
    start(chronometer) {
        chronometer.status = 2;
        if (!chronometer.intervalSub) {
            chronometer.intervalSub = interval(this.interval).subscribe(() => {
                chronometer = this.currentSecond(this.setTime(chronometer));
            });
        }
        return chronometer;
    }
    /**
     * @description inner the text element
     * @see {Chronometer}
     */
    get innerText() {
        const sep = (this.format || '').split('00');
        const a = this.isMinutes ? 1 : 0;
        switch (sep.length) {
            case 1: return `${sep[0]}${this.timeFormat[a]}${sep[1]}`;
            case 2: return `${sep[0]}${this.timeFormat[a]}${sep[1]}`;
            case 3: return `${sep[0]}${this.timeFormat[1]}${sep[1]}${this.timeFormat[0]}${sep[2]}`;
            case 4: return `${sep[0]}${this.timeFormat[2]}${sep[1]}${this.timeFormat[1]}${sep[2]}${this.timeFormat[0]}${sep[3]}`;
            default: return `${sep[0]}${this.timeFormat[2]}${sep[1]}${this.timeFormat[1]}${sep[2]}${this.timeFormat[0]}${sep[3]}`;
        }
    }
    /**
     * @description format array time
     * @see {Chronometer}
     */
    get timeFormat() {
        const time = this._chronometer.time;
        return Array(this.formatNumber(time[2]), this.formatNumber(time[1]), this.formatNumber(time[0]));
    }
    /**
     * @description return string 2 digit
     * @param n number to format
     */
    formatNumber(n) {
        return `${n > 9 ? n : `0${n}`}`;
    }
    /**
     * @description validator number
     * @param n number to valid
     */
    validNumber(n) {
        const enc = !_.isNaN(_.isNumber(n)) && n > 0;
        if (!enc) {
            console.error('Outdid maximo time no valid', n);
            this._chronometer.pause();
        }
        return enc ? n : 60;
    }
    /**
     * @description
     * @param chronometer object current chronometer
     * @see {Chronometer}
     * @param second increment the time
     * @see {increment} default [increment]="1"
     */
    setTime(chronometer, second = this.increment) {
        if (chronometer.second >= 0) {
            chronometer.second = chronometer.second + second;
            const diffSS = this.validNumber(chronometer.maxSecond);
            const diffMM = this.validNumber(chronometer.maxMinute);
            const hh = Math.trunc((chronometer.second / this.validNumber(chronometer.maxSecond)) / this.validNumber(chronometer.maxMinute));
            const mm = Math.trunc(chronometer.second / this.validNumber(chronometer.maxSecond)) - hh * diffMM;
            const ss = chronometer.second - Math.trunc(chronometer.second / diffSS) * diffSS;
            if (hh === chronometer.maxHour) {
                chronometer.second = 0;
                chronometer.time = new Array(0, 0, 0);
            }
            else {
                chronometer.time = new Array(hh, mm, ss);
            }
        }
        if (this.chronoEvents) {
            this.onChronoEvent.emit(chronometer);
        }
        return chronometer;
    }
    ngOnDestroy() {
        if (this.chronoSub) {
            this.chronoSub.unsubscribe();
        }
        if (this._chronometer.intervalSub) {
            this._chronometer.intervalSub.unsubscribe();
        }
        this._chronometer.onChronometer.unsubscribe();
    }
}
NgxChronometerDirective.decorators = [
    { type: Directive, args: [{
                // tslint:disable-next-line:directive-selector
                selector: '[chronometer]',
                // tslint:disable-next-line:no-host-metadata-property
                host: {
                    '[innerText]': 'innerText'
                }
            },] }
];
NgxChronometerDirective.ctorParameters = () => [];
NgxChronometerDirective.propDecorators = {
    interval: [{ type: Input }],
    increment: [{ type: Input }],
    limitSecond: [{ type: Input }],
    maxSecond: [{ type: Input }],
    maxMinute: [{ type: Input }],
    maxHour: [{ type: Input }],
    isMinutes: [{ type: Input }],
    chronometer: [{ type: Input }],
    format: [{ type: Input }],
    chronoEvents: [{ type: Input }],
    onChronoEvent: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWNocm9ub21ldGVyLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvbmd4LWNocm9ub21ldGVyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRixPQUFPLEVBQUUsV0FBVyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEUsT0FBTyxFQUFnQixRQUFRLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3ZELE9BQU8sS0FBSyxDQUFDLE1BQU0sUUFBUSxDQUFDO0FBVTVCLE1BQU0sT0FBTyx1QkFBdUI7SUFzQ2xDO1FBcENBLHlDQUF5QztRQUN6QyxpQkFBWSxHQUFnQixJQUFJLFdBQVcsRUFBRSxDQUFDO1FBRTlDLGdEQUFnRDtRQUN2QyxhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLHVCQUF1QjtRQUNkLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFvQnZCLHdFQUF3RTtRQUMvRCxXQUFNLEdBQUcsVUFBVSxDQUFDO1FBQzdCLDhEQUE4RDtRQUNyRCxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUU5QiwrQ0FBK0M7UUFDckMsa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBZSxDQUFDO0lBSTFDLENBQUM7SUFuQmpCLHlCQUF5QjtJQUN6QixJQUFhLFdBQVcsQ0FBQyxXQUF3QjtRQUMvQyxXQUFXLEdBQUcsV0FBVyxJQUFJLElBQUksV0FBVyxFQUFFLENBQUM7UUFDL0MsV0FBVyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxJQUFJLFdBQVcsQ0FBQyxTQUFTLElBQUksRUFBRSxDQUFDO1FBQ3RFLFdBQVcsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsSUFBSSxXQUFXLENBQUMsU0FBUyxJQUFJLEVBQUUs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QUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDekQsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDdkYsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDckgsT0FBTyxDQUFDLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1NBQ3ZIO0lBQ0gsQ0FBQztJQUVEOzs7T0FHRztJQUNILElBQUksVUFBVTtRQUNaLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDO1FBQ3BDLE9BQU8sS0FBSyxDQUNWLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFD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Q0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQzdDO1FBQ0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDaEQsQ0FBQzs7O1lBbE9GLFNBQVMsU0FBQztnQkFDVCw4Q0FBOEM7Z0JBQzlDLFFBQVEsRUFBRSxlQUFlO2dCQUN6QixxREFBcUQ7Z0JBQ3JELElBQUksRUFBRTtvQkFDSixhQUFhLEVBQUUsV0FBVztpQkFDM0I7YUFDRjs7Ozt1QkFPRSxLQUFLO3dCQUVMLEtBQUs7MEJBRUwsS0FBSzt3QkFFTCxLQUFLO3dCQUVMLEtBQUs7c0JBRUwsS0FBSzt3QkFFTCxLQUFLOzBCQUVMLEtBQUs7cUJBU0wsS0FBSzsyQkFFTCxLQUFLOzRCQUdMLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIElucHV0LCBPbkluaXQsIE9uRGVzdHJveSwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENocm9ub21ldGVyLCBTdGF0dXNDaG9ub21ldGVyIH0gZnJvbSAnLi9uZ3gtY2hyb25vbWV0ZXInO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uLCBpbnRlcnZhbCwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuXG5ARGlyZWN0aXZlKHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmRpcmVjdGl2ZS1zZWxlY3RvclxuICBzZWxlY3RvcjogJ1tjaHJvbm9tZXRlcl0nLFxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taG9zdC1tZXRhZGF0YS1wcm9wZXJ0eVxuICBob3N0OiB7XG4gICAgJ1tpbm5lclRleHRdJzogJ2lubmVyVGV4dCdcbiAgfVxufSlcbmV4cG9ydCBjbGFzcyBOZ3hDaHJvbm9tZXRlckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dmFyaWFibGUtbmFtZVxuICBfY2hyb25vbWV0ZXI6IENocm9ub21ldGVyID0gbmV3IENocm9ub21ldGVyKCk7XG5cbiAgLyoqIHNlcXVlbmNlIHRoZSB0aW1lIGRlZmF1bHQgMTAwMCA9IDEgc2Vjb25kICovXG4gIEBJbnB1dCgpIGludGVydmFsID0gMTAwMDtcbiAgLyoqIGluY3JlbWVudCAxIHVuaXQgKi9cbiAgQElucHV0KCkgaW5jcmVtZW50ID0gMTtcbiAgLyoqIGxpbWl0IGluIHNlY29uZCBzdG9wIHNlcXVlbmNlIHRoZSB0aW1lICovXG4gIEBJbnB1dCgpIGxpbWl0U2Vjb25kOiBudW1iZXI7XG4gIC8qKiBtYXhpbWFsIHNlY29uZCB0byBzdGVwIG1pbnV0ZSAqL1xuICBASW5wdXQoKSBtYXhTZWNvbmQ6IG51bWJlcjtcbiAgLyoqIG1heGltYWwgbWludXRlIHRvIHN0ZXAgaG91ciAqL1xuICBASW5wdXQoKSBtYXhNaW51dGU6IG51bWJlcjtcbiAgLyoqIG1heGltYWwgaG91ciB0byByZXNldCBjaHJvbm9tZXRlciAqL1xuICBASW5wdXQoKSBtYXhIb3VyOiBudW1iZXI7XG4gIC8qKiBtYXhpbWFsIGhvdXIgdG8gcmVzZXQgY2hyb25vbWV0ZXIgKi9cbiAgQElucHV0KCkgaXNNaW51dGVzOiBib29sZWFuO1xuICAvKiogb2JqZWN0IGNocm9ub21ldGVyICovXG4gIEBJbnB1dCgpIHNldCBjaHJvbm9tZXRlcihjaHJvbm9tZXRlcjogQ2hyb25vbWV0ZXIpIHtcbiAgICBjaHJvbm9tZXRlciA9IGNocm9ub21ldGVyIHx8IG5ldyBDaHJvbm9tZXRlcigpO1xuICAgIGNocm9ub21ldGVyLm1heFNlY29uZCA9IHRoaXMubWF4U2Vjb25kIHx8IGNocm9ub21ldGVyLm1heFNlY29uZCB8fCA2MDtcbiAgICBjaHJvbm9tZXRlci5tYXhNaW51dGUgPSB0aGlzLm1heE1pbnV0ZSB8fCBjaHJvbm9tZXRlci5tYXhNaW51dGUgfHwgNjA7XG4gICAgY2hyb25vbWV0ZXIubWF4SG91ciA9IHRoaXMubWF4SG91ciB8fCBjaHJvbm9tZXRlci5tYXhIb3VyIHx8IDYwO1xuICAgIGNocm9ub21ldGVyLnRpbWUgPSBuZXcgQXJyYXk8bnVtYmVyPigwLCAwLCAwKTtcbiAgICB0aGlzLl9jaHJvbm9tZXRlciA9IHRoaXMuYWN0aXZhdGVkKHRoaXMuY3VycmVudFNlY29uZChjaHJvbm9tZXRlcikpO1xuICB9XG4gIC8qKiBmb3JtYXQgdG8gdXNlIGRlZmF1bHQgMDA6MDA6MDAgY3VzdG9tIDAwLzAwLzAwIG9yIG90aGVyIGRlbGltaXRlciAqL1xuICBASW5wdXQoKSBmb3JtYXQgPSAnMDA6MDA6MDAnO1xuICAvKiogYWN0aXZhdGVkIGVtaXQgZXZlbnQgc2VxdWVuY2UgY2hyb25vbWV0ZXIgZGVmYXVsdCBmYWxzZSAqL1xuICBASW5wdXQoKSBjaHJvbm9FdmVudHMgPSBmYWxzZTtcblxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tb3V0cHV0LW9uLXByZWZpeFxuICBAT3V0cHV0KCkgb25DaHJvbm9FdmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8Q2hyb25vbWV0ZXI+KCk7XG5cbiAgcHJpdmF0ZSBjaHJvbm9TdWI6IFN1YnNjcmlwdGlvbjtcblxuICBjb25zdHJ1Y3RvcigpIHsgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcbiAgICBpZiAodGhpcy5fY2hyb25vbWV0ZXIub25DaHJvbm9tZXRlci5vYnNlcnZlcnMgPT0gbnVsbCkge1xuICAgICAgdGhpcy5fY2hyb25vbWV0ZXIub25DaHJvbm9tZXRlciA9IG5ldyBTdWJqZWN0PENocm9ub21ldGVyPigpO1xuICAgIH1cbiAgICB0aGlzLmNocm9ub1N1YiA9IHRoaXMuX2Nocm9ub21ldGVyLm9uQ2hyb25vbWV0ZXIuc3Vic2NyaWJlKChjaHJvbm9tZXRlcjogQ2hyb25vbWV0ZXIpID0+IHtcbiAgICAgIHRoaXMuX2Nocm9ub21ldGVyID0gdGhpcy5hY3RpdmF0ZWQodGhpcy5jdXJyZW50U2Vjb25kKGNocm9ub21ldGVyKSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIGN1cnJlbnQgc2Vjb25kc1xuICAgKiBAcGFyYW0gY2hyb25vbWV0ZXIgb2JqZWN0IGN1cnJlbnQgY2hyb25vbWV0ZXJcbiAgICogQHNlZSB7Q2hyb25vbWV0ZXJ9XG4gICAqL1xuICBjdXJyZW50U2Vjb25kKGNocm9ub21ldGVyOiBDaHJvbm9tZXRlcik6IENocm9ub21ldGVyIHtcbiAgICBjb25zdCBsaW1pdFNlY29uZCA9IHRoaXMubGltaXRTZWNvbmQgfHwgY2hyb25vbWV0ZXIubGltaXRTZWNvbmQ7XG4gICAgaWYgKGxpbWl0U2Vjb25kICYmIGNocm9ub21ldGVyLnNlY29uZCA+IGxpbWl0U2Vjb25kKSB7XG4gICAgICBjaHJvbm9tZXRlci5zZWNvbmQgPSBsaW1pdFNlY29uZDtcbiAgICAgIGNocm9ub21ldGVyLnBhdXNlKCk7XG4gICAgICB0aGlzLl9jaHJvbm9tZXRlciA9IGNocm9ub21ldGVyO1xuICAgICAgaWYgKHRoaXMuX2Nocm9ub21ldGVyLmludGVydmFsU3ViKSB7XG4gICAgICAgIHRoaXMuX2Nocm9ub21ldGVyLmludGVydmFsU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9jaHJvbm9tZXRlci5pbnRlcnZhbFN1YiA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIGNocm9ub21ldGVyO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBhY3RpdmF0ZWQgY2hyb25vbWV0ZXJcbiAgICogQHBhcmFtIGNocm9ub21ldGVyIG9iamVjdCBjdXJyZW50IGNocm9ub21ldGVyXG4gICAqIEBzZWUge0Nocm9ub21ldGVyfVxuICAgKi9cbiAgcHJpdmF0ZSBhY3RpdmF0ZWQoY2hyb25vbWV0ZXI6IENocm9ub21ldGVyID0gdGhpcy5fY2hyb25vbWV0ZXIpOiBDaHJvbm9tZXRlciB7XG4gICAgc3dpdGNoIChjaHJvbm9tZXRlci5zdGF0dXMpIHtcbiAgICAgIGNhc2UgU3RhdHVzQ2hvbm9tZXRlci5wYXVzZTpcbiAgICAgICAgdGhpcy5fY2hyb25vbWV0ZXIgPSB0aGlzLnBhdXNlKGNocm9ub21ldGVyKTsgYnJlYWs7XG4gICAgICBjYXNlIFN0YXR1c0Nob25vbWV0ZXIuc3RhcnQ6XG4gICAgICAgIHRoaXMuX2Nocm9ub21ldGVyID0gdGhpcy5zdGFydCh0aGlzLnBhdXNlKGNocm9ub21ldGVyKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBTdGF0dXNDaG9ub21ldGVyLnJlc3RhcnQ6XG4gICAgICAgIGNocm9ub21ldGVyLnNlY29uZCA9IDA7XG4gICAgICAgIHRoaXMuX2Nocm9ub21ldGVyID0gdGhpcy5zdGFydChjaHJvbm9tZXRlcik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBTdGF0dXNDaG9ub21ldGVyLnN0b3A6XG4gICAgICAgIGNocm9ub21ldGVyLnNlY29uZCA9IDA7XG4gICAgICAgIHRoaXMuX2Nocm9ub21ldGVyID0gdGhpcy5wYXVzZShjaHJvbm9tZXRlcik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnNldFRpbWUoY2hyb25vbWV0ZXIsIDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBwYXVzZSBzZWNvbmRzXG4gICAqIEBwYXJhbSBjaHJvbm9tZXRlciBvYmplY3QgY3VycmVudCBjaHJvbm9tZXRlclxuICAgKiBAc2VlIHtDaHJvbm9tZXRlcn1cbiAgICovXG4gIHByaXZhdGUgcGF1c2UoY2hyb25vbWV0ZXI6IENocm9ub21ldGVyKTogQ2hyb25vbWV0ZXIge1xuICAgIHJldHVybiB0aGlzLnN0b3AoY2hyb25vbWV0ZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBzdG9wIHNlY29uZHNcbiAgICogQHBhcmFtIGNocm9ub21ldGVyIG9iamVjdCBjdXJyZW50IGNocm9ub21ldGVyXG4gICAqIEBzZWUge0Nocm9ub21ldGVyfVxuICAgKi9cbiAgcHJpdmF0ZSBzdG9wKGNocm9ub21ldGVyKTogQ2hyb25vbWV0ZXIge1xuICAgIGlmIChjaHJvbm9tZXRlci5pbnRlcnZhbFN1Yikge1xuICAgICAgY2hyb25vbWV0ZXIuaW50ZXJ2YWxTdWIudW5zdWJzY3JpYmUoKTtcbiAgICAgIGNocm9ub21ldGVyLmludGVydmFsU3ViID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICByZXR1cm4gY2hyb25vbWV0ZXI7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIHN0YXJ0IHNlY29uZHNcbiAgICogQHBhcmFtIGNocm9ub21ldGVyIG9iamVjdCBjdXJyZW50IGNocm9ub21ldGVyXG4gICAqIEBzZWUge0Nocm9ub21ldGVyfVxuICAgKi9cbiAgcHJpdmF0ZSBzdGFydChjaHJvbm9tZXRlcjogQ2hyb25vbWV0ZXIpOiBDaHJvbm9tZXRlciB7XG4gICAgY2hyb25vbWV0ZXIuc3RhdHVzID0gMjtcbiAgICBpZiAoIWNocm9ub21ldGVyLmludGVydmFsU3ViKSB7XG4gICAgICBjaHJvbm9tZXRlci5pbnRlcnZhbFN1YiA9IGludGVydmFsKHRoaXMuaW50ZXJ2YWwpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIGNocm9ub21ldGVyID0gdGhpcy5jdXJyZW50U2Vjb25kKHRoaXMuc2V0VGltZShjaHJvbm9tZXRlcikpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBjaHJvbm9tZXRlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gaW5uZXIgdGhlIHRleHQgZWxlbWVudFxuICAgKiBAc2VlIHtDaHJvbm9tZXRlcn1cbiAgICovXG4gIGdldCBpbm5lclRleHQoKTogc3RyaW5nIHtcbiAgICBjb25zdCBzZXAgPSAodGhpcy5mb3JtYXQgfHwgJycpLnNwbGl0KCcwMCcpO1xuICAgIGNvbnN0IGEgPSB0aGlzLmlzTWludXRlcyA/IDEgOiAwO1xuICAgIHN3aXRjaCAoc2VwLmxlbmd0aCkge1xuICAgICAgY2FzZSAxOiByZXR1cm4gYCR7c2VwWzBdfSR7dGhpcy50aW1lRm9ybWF0W2FdfSR7c2VwWzFdfWA7XG4gICAgICBjYXNlIDI6IHJldHVybiBgJHtzZXBbMF19JHt0aGlzLnRpbWVGb3JtYXRbYV19JHtzZXBbMV19YDtcbiAgICAgIGNhc2UgMzogcmV0dXJuIGAke3NlcFswXX0ke3RoaXMudGltZUZvcm1hdFsxXX0ke3NlcFsxXX0ke3RoaXMudGltZUZvcm1hdFswXX0ke3NlcFsyXX1gO1xuICAgICAgY2FzZSA0OiByZXR1cm4gYCR7c2VwWzBdfSR7dGhpcy50aW1lRm9ybWF0WzJdfSR7c2VwWzFdfSR7dGhpcy50aW1lRm9ybWF0WzFdfSR7c2VwWzJdfSR7dGhpcy50aW1lRm9ybWF0WzBdfSR7c2VwWzNdfWA7XG4gICAgICBkZWZhdWx0OiByZXR1cm4gYCR7c2VwWzBdfSR7dGhpcy50aW1lRm9ybWF0WzJdfSR7c2VwWzFdfSR7dGhpcy50aW1lRm9ybWF0WzFdfSR7c2VwWzJdfSR7dGhpcy50aW1lRm9ybWF0WzBdfSR7c2VwWzNdfWA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvbiBmb3JtYXQgYXJyYXkgdGltZVxuICAgKiBAc2VlIHtDaHJvbm9tZXRlcn1cbiAgICovXG4gIGdldCB0aW1lRm9ybWF0KCk6IEFycmF5PHN0cmluZz4ge1xuICAgIGNvbnN0IHRpbWUgPSB0aGlzLl9jaHJvbm9tZXRlci50aW1lO1xuICAgIHJldHVybiBBcnJheTxzdHJpbmc+KFxuICAgICAgdGhpcy5mb3JtYXROdW1iZXIodGltZVsyXSksXG4gICAgICB0aGlzLmZvcm1hdE51bWJlcih0aW1lWzFdKSxcbiAgICAgIHRoaXMuZm9ybWF0TnVtYmVyKHRpbWVbMF0pXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb24gcmV0dXJuIHN0cmluZyAyIGRpZ2l0XG4gICAqIEBwYXJhbSBuIG51bWJlciB0byBmb3JtYXRcbiAgICovXG4gIGZvcm1hdE51bWJlcihuOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiBgJHtuID4gOSA/IG4gOiBgMCR7bn1gfWA7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uIHZhbGlkYXRvciBudW1iZXJcbiAgICogQHBhcmFtIG4gbnVtYmVyIHRvIHZhbGlkXG4gICAqL1xuICB2YWxpZE51bWJlcihuOiBudW1iZXIpIHtcbiAgICBjb25zdCBlbmMgPSAhXy5pc05hTihfLmlzTnVtYmVyKG4pKSAmJiBuID4gMDtcbiAgICBpZiAoIWVuYykge1xuICAgICAgY29uc29sZS5lcnJvcignT3V0ZGlkIG1heGltbyB0aW1lIG5vIHZhbGlkJywgbik7XG4gICAgICB0aGlzLl9jaHJvbm9tZXRlci5wYXVzZSgpO1xuICAgIH1cbiAgICByZXR1cm4gZW5jID8gbiA6IDYwO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBAcGFyYW0gY2hyb25vbWV0ZXIgb2JqZWN0IGN1cnJlbnQgY2hyb25vbWV0ZXJcbiAgICogQHNlZSB7Q2hyb25vbWV0ZXJ9XG4gICAqIEBwYXJhbSBzZWNvbmQgaW5jcmVtZW50IHRoZSB0aW1lXG4gICAqIEBzZWUge2luY3JlbWVudH0gZGVmYXVsdCBbaW5jcmVtZW50XT1cIjFcIlxuICAgKi9cbiAgcHJpdmF0ZSBzZXRUaW1lKGNocm9ub21ldGVyOiBDaHJvbm9tZXRlciwgc2Vjb25kID0gdGhpcy5pbmNyZW1lbnQpOiBDaHJvbm9tZXRlciB7XG4gICAgaWYgKGNocm9ub21ldGVyLnNlY29uZCA+PSAwKSB7XG4gICAgICBjaHJvbm9tZXRlci5zZWNvbmQgPSBjaHJvbm9tZXRlci5zZWNvbmQgKyBzZWNvbmQ7XG4gICAgICBjb25zdCBkaWZmU1MgPSB0aGlzLnZhbGlkTnVtYmVyKGNocm9ub21ldGVyLm1heFNlY29uZCk7XG4gICAgICBjb25zdCBkaWZmTU0gPSB0aGlzLnZhbGlkTnVtYmVyKGNocm9ub21ldGVyLm1heE1pbnV0ZSk7XG4gICAgICBjb25zdCBoaCA9IE1hdGgudHJ1bmMoKGNocm9ub21ldGVyLnNlY29uZCAvIHRoaXMudmFsaWROdW1iZXIoY2hyb25vbWV0ZXIubWF4U2Vjb25kKSkgLyB0aGlzLnZhbGlkTnVtYmVyKGNocm9ub21ldGVyLm1heE1pbnV0ZSkpO1xuICAgICAgY29uc3QgbW0gPSBNYXRoLnRydW5jKGNocm9ub21ldGVyLnNlY29uZCAvIHRoaXMudmFsaWROdW1iZXIoY2hyb25vbWV0ZXIubWF4U2Vjb25kKSkgLSBoaCAqIGRpZmZNTTtcbiAgICAgIGNvbnN0IHNzID0gY2hyb25vbWV0ZXIuc2Vjb25kIC0gTWF0aC50cnVuYyhjaHJvbm9tZXRlci5zZWNvbmQgLyBkaWZmU1MpICogZGlmZlNTO1xuICAgICAgaWYgKGhoID09PSBjaHJvbm9tZXRlci5tYXhIb3VyKSB7XG4gICAgICAgIGNocm9ub21ldGVyLnNlY29uZCA9IDA7XG4gICAgICAgIGNocm9ub21ldGVyLnRpbWUgPSBuZXcgQXJyYXkoMCwgMCwgMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjaHJvbm9tZXRlci50aW1lID0gbmV3IEFycmF5KGhoLCBtbSwgc3MpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5jaHJvbm9FdmVudHMpIHtcbiAgICAgIHRoaXMub25DaHJvbm9FdmVudC5lbWl0KGNocm9ub21ldGVyKTtcbiAgICB9XG4gICAgcmV0dXJuIGNocm9ub21ldGVyO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuY2hyb25vU3ViKSB7XG4gICAgICB0aGlzLmNocm9ub1N1Yi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fY2hyb25vbWV0ZXIuaW50ZXJ2YWxTdWIpIHtcbiAgICAgIHRoaXMuX2Nocm9ub21ldGVyLmludGVydmFsU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICAgIHRoaXMuX2Nocm9ub21ldGVyLm9uQ2hyb25vbWV0ZXIudW5zdWJzY3JpYmUoKTtcbiAgfVxuXG59XG4iXX0=